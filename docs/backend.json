{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the UCS Index Tracker application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user in the system (e.g., admin, user).",
          "enum": ["admin", "user"]
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp when the user was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The timestamp when the user was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role",
        "createdAt",
        "updatedAt"
      ]
    },
    "Commodity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Commodity",
      "type": "object",
      "description": "Represents a commodity used in UCS index calculation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Commodity entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the commodity (e.g., Gold, Silver)."
        },
        "symbol": {
          "type": "string",
          "description": "The symbol or ticker of the commodity (e.g., XAU, AG)."
        },
        "sourceUrl": {
          "type": "string",
          "description": "The URL where the commodity price data is scraped from.",
          "format": "uri"
        },
        "weight": {
          "type": "number",
          "description": "The weight of the commodity in the UCS index calculation."
        }
      },
      "required": [
        "id",
        "name",
        "symbol",
        "sourceUrl",
        "weight"
      ]
    },
    "UcsIndex": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UcsIndex",
      "type": "object",
      "description": "Represents the calculated UCS index value at a specific point in time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UcsIndex entity."
        },
        "value": {
          "type": "number",
          "description": "The calculated UCS index value."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp when the index value was calculated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "value",
        "timestamp"
      ]
    },
    "AlertConfiguration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AlertConfiguration",
      "type": "object",
      "description": "Represents the configuration for email alerts.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AlertConfiguration entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N AlertConfiguration)"
        },
        "threshold": {
          "type": "number",
          "description": "The threshold value that triggers the alert."
        },
        "condition": {
          "type": "string",
          "description": "The condition to trigger the alert (e.g., 'above', 'below')."
        },
        "email": {
          "type": "string",
          "description": "The email address to send alerts to.",
          "format": "email"
        },
        "enabled": {
          "type": "boolean",
          "description": "Indicates whether the alert is enabled or disabled."
        }
      },
      "required": [
        "id",
        "userId",
        "threshold",
        "condition",
        "email",
        "enabled"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data.  This collection is primarily for user management, not direct application data.  'userId' is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Documents in this collection indicate admin roles. Existence of a document with a specific UID grants admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the administrator."
            }
          ]
        }
      },
      {
        "path": "/commodities/{commodityId}",
        "definition": {
          "entityName": "Commodity",
          "schema": {
            "$ref": "#/backend/entities/Commodity"
          },
          "description": "Stores commodity definitions, including name, symbol, source URL, and weight.",
          "params": [
            {
              "name": "commodityId",
              "description": "Unique identifier for the commodity."
            }
          ]
        }
      },
      {
        "path": "/ucs_indices/{ucsIndexId}",
        "definition": {
          "entityName": "UcsIndex",
          "schema": {
            "$ref": "#/backend/entities/UcsIndex"
          },
          "description": "Stores calculated UCS index values with timestamps.",
          "params": [
            {
              "name": "ucsIndexId",
              "description": "Unique identifier for the UCS index entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/alerts/{alertId}",
        "definition": {
          "entityName": "AlertConfiguration",
          "schema": {
            "$ref": "#/backend/entities/AlertConfiguration"
          },
          "description": "Stores alert configurations for each user.  Path-based ownership ensures only the user can access their alerts.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Auth UID of the user."
            },
            {
              "name": "alertId",
              "description": "Unique identifier for the alert configuration."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the UCS Index Tracker application, focusing on secure user management, commodity data, UCS index calculations, and alert configurations.  Authorization Independence is achieved by using path-based ownership for user-related data (alerts) and a dedicated admin role collection.  \n\nSegregation is implemented by separating user data, commodity definitions, UCS index values, and alert configurations into distinct collections, each with specific security rules.\n\nQAPs are supported by:\n\n*   Path-based ownership (`/users/{userId}/alerts/{alertId}`) which allows secure listing of alerts for a specific user.\n*   Admin role collection (`/roles_admin/{userId}`) enabling secure listing of admins.\n*   Commodities and UCS Indices are global, but CRUD operations are restricted to admins.\n\nInvariants such as ownership and timestamps can be enforced using security rules within each collection."
  }
}